{% extends 'layout.html' %}

{% load static %}

{% block head %}

    {{ block.super }}

    <link rel="stylesheet" href="{% static 'CSSDocs/mealOverview.css' %}">
<script>
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function myFunction2() {
  document.getElementById("myDropdown2").classList.toggle("show");
}

function filter() {
  events = {{events}}


  if (document.querySelector('.allergyCheck:checked')) {
    var checkedValue = document.querySelectorAll('.allergyCheck:checked');

    for (var key in events) {
      for(var i = 0; i < checkedValue.length; i++){

        var dinner = document.getElementById("allergy-"+key)
          if(events[key].includes(parseInt(checkedValue[i].value))) {
            dinner.style.display = "none";
            break;
          }
          else {
            dinner.style.display ="initial";
          }
      }
    }
  } else {

    var dinners =  document.getElementsByClassName("url");
    for (var key in events) {
      document.getElementById("allergy-"+key).style.display ="initial";
    }
  }
}


function filter_location() {

  event_location = {{event_location|safe}}


  if (document.querySelector('.locationCheck:checked')) {
    var checkedValue = document.querySelectorAll('.locationCheck:checked');

    for (var key in event_location) {
      for(var i = 0; i < checkedValue.length; i++){

        var dinner = document.getElementById("allergy-"+key)
          if(event_location[key].includes((checkedValue[i].value))) {
            dinner.style.display = "initial";
            break;
          }
          else {
            dinner.style.display ="none";
          }
      }
    }
  } else {

    var dinners =  document.getElementsByClassName("url");
    for (var key in event_location) {
      document.getElementById("allergy-"+key).style.display ="initial";
    }
  }
}


// Close the dropdown menu if the user clicks outside of it
window.onclick = function(event) {
  if (!event.target.matches('.dropbtn')) {
    var dropdowns = document.getElementsByClassName("dropdown-content");
    var i;
    for (i = 0; i < dropdowns.length; i++) {
      var openDropdown = dropdowns[i];
      if (openDropdown.classList.contains('show')) {
        openDropdown.classList.remove('show');
      }
    }
  }
}

</script>

{% endblock %}

{% block content %}


        <h1 class="meal-overview-header">
            Middagsoversikt
        </h1>

<div class="dropdown">
  <button onclick="myFunction()" class="dropbtn">Filtrer allergi</button>
  <div id="myDropdown" class="dropdown-content">
      <form>

          {% for allergy in allergies %}
           <input class="allergyCheck" type="checkbox" id={{allergy.ingredient_id}} name={{allergy.name}} value={{allergy.ingredient_id}} onclick="filter()">
            <label for={{allergy.ingredient_id}} id="allergi"> {{allergy.name}}</label><br>
           {% endfor %}
      </form>
  </div>
</div>


<div class="dropdown">
  <button class="dropbtn" onclick="myFunction2()">Filtrer sted</button>
  <div class="dropdown-content" id="myDropdown2">
      <form>
          {% for loc in locations %}
           <input class="locationCheck" type="checkbox" id="{{loc}}" name={{loc}} value={{loc}} onclick="filter_location()">
            <label for={{loc}}> {{loc}}</label><br>
           {% endfor %}
      </form>
  </div>
</div>

<div class="flex-container">
        {% for instance in object_list %}



        <div class="url" onclick="location.href= '{% url 'chooseMeal' event_id=instance.event_id %}' " id="allergy-{{instance.event_id}}">

                <div class="flex-child">
                    <h3>{{instance.name}}</h3>
                    {% for key, item in available_dict.items %}
                        {% if key == instance.event_id %}
                            <h5>Ledige plasser: {{ item }}/{{instance.capacity}}</h5>
                        {% endif %}
                    {% endfor %}

                    {% for x in mealAllergies %}
                    {{x.ingredient_id}}
                    {% endfor %}
                    <h5>Tidspunkt: {{instance.date}}</h5>
                    <h5>Pris: {{instance.cost}}</h5>
                    <br>
                </div>
            </div>



        {% endfor %}
</div>

{% endblock %}
